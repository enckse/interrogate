pkgname=survey
pkgver=r23.83c6d4d
pkgrel=1
pkgdesc="a basic/primitive survey app for LAN-based survey completion"
arch=('x86_64')
url="https://github.com/epiphyte/survey"
license=('MIT')
makedepends=('python' 'python-setuptools' 'curl')
source=("git+$url")
sha512sums=('SKIP')
_pkgdir="/opt/epiphyte/survey"

pkgver() {
    cd ${srcdir}/$pkgname
    printf "r%s.%s" "$(git rev-list --count HEAD)" "$(git rev-parse --short HEAD)"
}

build() {
    cd ${srcdir}/$pkgname
    make dependencies
}

package() {
    cd ${srcdir}/$pkgname
    local pack=$pkgdir/$_pkgdir
    for f in $(find static/* -type f -print | grep -v ".git"); do
        install -Dm644 $f $pack/$f
    done
    install -Dm755 survey.sh $pkgdir/usr/local/bin/survey
    install -Dm644 survey.py $pack/survey.py
    install -Dm644 -d $pack/artifacts
    python3 setup.py install --root="$pkgdir/" --optimize=1
}
