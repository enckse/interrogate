pkgname=survey
pkgver=r27.8dd0fa9
pkgrel=1
pkgdesc="a basic/primitive survey app for LAN-based survey completion"
arch=('x86_64')
url="https://github.com/epiphyte/survey"
license=('MIT')
depends=('python' 'python-flask')
makedepends=('python-setuptools' 'curl' 'git')
source=("git+$url")
sha512sums=('SKIP')
_pkgdir="/opt/epiphyte/survey"

pkgver() {
    cd ${srcdir}/$pkgname
    printf "r%s.%s" "$(git rev-list --count HEAD)" "$(git rev-parse --short HEAD)"
}

build() {
    cd ${srcdir}/$pkgname
    make dependencies
}

package() {
    cd ${srcdir}/$pkgname
    local pack=$pkgdir/$_pkgdir
    for i in $(echo "static templates"); do
        for f in $(find $i/* -type f -print | grep -v ".git"); do
            install -Dm644 $f $pack/$f
        done
    done
    install -Dm755 survey.sh $pkgdir/usr/local/bin/survey
    install -Dm644 survey.py $pack/survey.py
    install -Dm644 -d $pack/artifacts
    install -Dm644 -d $pack/questions
}
